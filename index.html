<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rádió Pro - Hangjelzéssel</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #111; padding: 30px; border-radius: 20px; border: 1px solid #00ff96; width: 320px; text-align: center; }
        .btn { padding: 15px; width: 100%; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin: 10px 0; text-transform: uppercase; }
        .play { background: #00ff96; color: #000; }
        .stop { background: #ff4b2b; color: #fff; }
        #unmute-btn { background: #ff9800; display: none; animation: flash 1s infinite; }
        @keyframes flash { 50% { opacity: 0.5; } }
        input { width: 90%; padding: 10px; margin-bottom: 10px; background: #222; border: 1px solid #444; color: #fff; text-align: center; }
        .status { font-size: 12px; color: #666; margin-top: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h2 id="title">Rádió Vezérlő</h2>
    
    <div id="login-panel">
        <input type="password" id="pw" placeholder="Admin jelszó (123)">
        <button class="btn" style="background:#333; color:white;" onclick="init('admin')">BELÉPÉS ADMINKÉNT</button>
        <hr style="border:0.5px solid #222;">
        <button class="btn play" onclick="init('user')">CSATLAKOZÁS HALLGATÓKÉNT</button>
    </div>

    <button id="unmute-btn" class="btn" onclick="activateAudio()">⚠️ HANG AKTIVÁLÁSA</button>

    <div id="admin-controls" style="display:none;">
        <button class="btn play" onclick="broadcast('play')">▶ INDÍTÁS MINDENKINÉL</button>
        <button class="btn stop" onclick="broadcast('stop')">■ STOP MINDENKINÉL</button>
        <p>Hallgatók: <span id="count">0</span></p>
    </div>

    <p id="msg" class="status">Válassz szerepkört...</p>
</div>

<audio id="player" loop crossorigin="anonymous"></audio>

<script>
    const player = document.getElementById('player');
    player.src = "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3";

    let peer, conns = [];
    const SERVER_ID = "SajatRadio2024Unique";

    // Beszéd szintézis (bemondáshoz)
    function speak(text) {
        const msg = new SpeechSynthesisUtterance();
        msg.text = text;
        msg.lang = 'hu-HU';
        window.speechSynthesis.speak(msg);
    }

    // Rövid sípolás (aktiváláshoz)
    function playBeep() {
        const context = new (window.AudioContext || window.webkitAudioContext)();
        const osc = context.createOscillator();
        osc.type = "sine";
        osc.frequency.setValueAtTime(880, context.currentTime);
        osc.connect(context.destination);
        osc.start();
        osc.stop(context.currentTime + 0.1);
    }

    function init(mode) {
        if(mode === 'admin' && document.getElementById('pw').value !== '123') return alert("Hoppá!");
        document.getElementById('login-panel').style.display = 'none';
        document.getElementById('unmute-btn').style.display = 'block';

        peer = new Peer(mode === 'admin' ? SERVER_ID : null);
        peer.on('open', (id) => {
            if(mode === 'admin') {
                document.getElementById('admin-controls').style.display = 'block';
                document.getElementById('msg').innerText = "Szerver Online!";
            } else {
                document.getElementById('msg').innerText = "Kapcsolódás az adóhoz...";
                const c = peer.connect(SERVER_ID);
                c.on('open', () => document.getElementById('msg').innerText = "Csatlakozva!");
                c.on('data', (data) => handleCommand(data));
            }
        });
        peer.on('connection', (c) => {
            conns.push(c);
            document.getElementById('count').innerText = conns.length;
        });
    }

    function handleCommand(cmd) {
        if(cmd === 'play') {
            speak("Adás elindult");
            setTimeout(() => player.play(), 1500); // Vár egy kicsit, amíg a beszéd véget ér
        }
        if(cmd === 'stop') player.pause();
    }

    function broadcast(cmd) {
        conns.forEach(c => c.send(cmd));
        handleCommand(cmd);
    }

    function activateAudio() {
        // Hangfeloldás kísérlete
        playBeep(); // Adunk egy sípjelet
        player.play().then(() => {
            player.pause();
            document.getElementById('unmute-btn').style.display = 'none';
            document.getElementById('msg').innerText = "Hang engedélyezve!";
        }).catch(e => {
            // Ha még nem engedi, a sípjel akkor is jelzi, hogy interakció történt
            document.getElementById('unmute-btn').innerText = "KATTINTS ÚJRA!";
        });
    }
</script>

</body>
</html>a
