<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Saját Rádió - GitHub Verzió</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #121212; color: white; font-family: sans-serif; text-align: center; padding: 20px; }
        .box { background: #1e1e1e; padding: 30px; border-radius: 15px; display: inline-block; border: 1px solid #333; width: 90%; max-width: 400px; }
        .btn { padding: 15px; width: 100%; font-size: 16px; cursor: pointer; border: none; border-radius: 8px; margin: 10px 0; font-weight: bold; }
        .play { background: #00ff96; color: black; }
        .stop { background: #ff4b2b; color: white; }
        input { padding: 12px; width: 90%; border-radius: 5px; border: 1px solid #444; background: #121212; color: white; margin-bottom: 10px; text-align: center; }
        #unmute-btn { display: none; background: #ff9800; color: black; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    </style>
</head>
<body>

<div class="box">
    <h1>Rádió Vezérlő</h1>
    
    <div id="setup">
        <input type="password" id="pw" placeholder="Jelszó (123)">
        <button class="btn" style="background: #333; color: white;" onclick="belep('admin')">Belépés Adminként</button>
        <hr>
        <button class="btn play" onclick="belep('user')">Csatlakozás Hallgatóként</button>
    </div>

    <button id="unmute-btn" class="btn" onclick="feloldHang()">⚠️ KATTINTS IDE A HANGHOZ!</button>

    <div id="admin-panel" style="display:none;">
        <h2 style="color:#00ff96;">ADMIN</h2>
        <button class="btn play" onclick="parancs('play')">INDÍTÁS MINDENKINÉL</button>
        <button class="btn stop" onclick="parancs('stop')">MEGÁLLÍTÁS</button>
        <p>Hallgatók: <span id="count">0</span></p>
    </div>

    <p id="msg" style="color: #888; font-size: 12px;">Válassz szerepkört...</p>
</div>

<audio id="audio" loop crossOrigin="anonymous">
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
</audio>

<script>
    const audio = document.getElementById('audio');
    const msg = document.getElementById('msg');
    let peer, conns = [];
    const ID = "FIX-RADIO-ID-2024"; // Ezt használd a csatlakozáshoz

    function belep(tipus) {
        if(tipus === 'admin' && document.getElementById('pw').value !== "123") return alert("Rossz jelszó!");
        document.getElementById('setup').style.display = 'none';

        peer = new Peer(tipus === 'admin' ? ID : null);

        peer.on('open', (myId) => {
            if(tipus === 'admin') {
                document.getElementById('admin-panel').style.display = 'block';
                msg.innerText = "Szerver kész. ID: " + myId;
            } else {
                msg.innerText = "Csatlakozás az adminhoz...";
                const c = peer.connect(ID);
                setupConn(c);
                document.getElementById('unmute-btn').style.display = 'block';
            }
        });

        peer.on('connection', (c) => {
            conns.push(c);
            document.getElementById('count').innerText = conns.length;
            msg.innerText = "Hallgató csatlakozott!";
        });

        peer.on('error', (err) => {
            msg.innerText = "Hiba történt. Frissíts rá!";
            console.error(err);
        });
    }

    function setupConn(c) {
        c.on('open', () => msg.innerText = "Sikeres csatlakozás!");
        c.on('data', (data) => {
            if(data === 'play') audio.play().catch(() => msg.innerText = "Kattints a narancs gombra!");
            if(data === 'stop') audio.pause();
        });
    }

    function parancs(cmd) {
        conns.forEach(c => c.send(cmd));
        cmd === 'play' ? audio.play() : audio.pause();
    }

    function feloldHang() {
        audio.play().then(() => {
            audio.pause();
            document.getElementById('unmute-btn').style.display = 'none';
            msg.innerText = "Hang engedélyezve. Várj az adminra!";
        });
    }
</script>
</body>
</html>
